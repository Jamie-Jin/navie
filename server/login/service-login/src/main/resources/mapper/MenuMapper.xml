<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.jamie.service.login.dao.MenuDao">

    <insert id="insert" keyProperty="id"
            parameterType="com.jamie.service.login.entity.MenuEntity">
        insert into `menu`
        <trim prefix="(" suffix=")" suffixOverrides=",">
            path,
        </trim>
        <trim prefix="values(" suffix=")" suffixOverrides=",">
            #{path},
        </trim>
    </insert>

    <!-- 获取所有角色对应的菜单路径 start -->
    <resultMap id="RoleMenuResultMap" type="com.jamie.service.login.vo.RoleMenuVo">
        <id property="id" column="id"/>
        <result property="menu" column="menu"/>
        <collection property="roleVos" ofType="com.jamie.service.login.vo.RoleVo">
            <id column="id" property="roleId"/>
            <result column="role" property="role"/>
            <result column="role_cn" property="roleCn"/>
        </collection>
    </resultMap>
    
    <select id="getRoleMenus" resultMap="RoleMenuResultMap">
        select
        <trim suffixOverrides=",">
            m.id as menuId,
            m.path as menu,
            r.id as roleId,
            r.role,
            r.role_cn,
        </trim>
        from `menu` m
        left join `menu_role` mr on m.id = mr.menu_id
        left join `role` r on r.id = mr.role_id
    </select>
    <!-- 获取所有角色对应的菜单路径 end -->

</mapper>